// var TodoTxtExtension;

// TodoTxtExtension = "function" == typeof require ? require("./jsTodoExtensions").TodoTxtExtension : window.TodoTxtExtension;

var TodoTxt = {
    _trim_re: /^\s+|\s+$/g,
    _complete_re: /^x\s([0-9]{4}-[0-9]{1,2}-[0-9]{1,2})\s+/i,
    _complete_replace_re: /^x\s([0-9]{4}-[0-9]{1,2}-[0-9]{1,2})\s+/i,
    _date_re: /^([0-9]{4}-[0-9]{1,2}-[0-9]{1,2})/,
    _date_replace_re: /^[0-9]{4}-[0-9]{1,2}-[0-9]{1,2}\s*/,
    _priority_re: /^\(([A-Z])\)/,
    _priority_replace_re: /^\([A-Z]\)\s*/,
    _context_re: /(^|\s+)@(\S+)/g,
    _context_replace_re: /(^|\s+)@\S+/g,
    _project_re: /(^|\s+)\+(\S+)/g,
    _project_replace_re: /(^|\s+)\+\S+/g,
    parse: function (t, e, n) {
        var i, o = [],
            r = t.split("\n");
        for (i = 0; i < r.length; i++) try {
            o.push(new TodoTxtItem(r[i], e))
        } catch (t) {
            void 0 !== n && n(t)
        }
        return o
    },
    parseLine: function (t) {
        return new TodoTxtItem(t)
    },
    render: function (t) {
        var e, n = [];
        for (e in t) Object.prototype.hasOwnProperty.call(t, e) && n.push(t[e].toString());
        return n.join("\n")
    },
    renderItem: function (t) {
        return t.toString()
    }
};

function TodoTxtItem(t, e) {
    this.reset = function () {
        this.text = null, this.priority = null, this.complete = !1, this.completed = null, this.date = null, this.contexts = null, this.projects = null
    }, this.dateString = function () {
        return this.date ? this.date.getFullYear() + "-" + (this.date.getMonth() + 1 < 10 ? "0" : "") + (this.date.getMonth() + 1) + "-" + (this.date.getDate() < 10 ? "0" : "") + this.date.getDate() : null
    }, this.completedString = function () {
        return this.completed ? this.completed.getFullYear() + "-" + (this.completed.getMonth() + 1 < 10 ? "0" : "") + (this.completed.getMonth() + 1) + "-" + (this.completed.getDate() < 10 ? "0" : "") + this.completed.getDate() : null
    }, this.toString = function () {
        var t = this.text;
        return null !== this.date && (t = this.dateString() + " " + t), null !== this.priority && (t = "(" + this.priority + ") " + t), this.complete && null !== this.completed && (t = "x " + this.completedString() + " " + t), "" !== this.extensionStrings() && (t += this.extensionStrings()), null !== this.projects && (t = t + " +" + this.projects.join(" +")), null !== this.contexts && (t = t + " @" + this.contexts.join(" @")), t
    }, this.extensionStrings = function () {
        var t, e, n = "";
        if (null !== this.extensions)
            for (e = 0, t = this.extensions.length; e < t; e++) void 0 !== this[this.extensions[e].name + "String"] && (n = n + " " + this.extensions[e].name + ":" + this[this.extensions[e].name + "String"]);
        return n
    }, this.parse = function (t) {
        var e;
        this.reset(), t = (t = t.replace(TodoTxt._trim_re, "")).replace("\r", "");
        var n = TodoTxt._complete_re.exec(t);
        null !== n && (this.complete = !0, e = n[1].split("-"), this.completed = new Date(e[0], e[1] - 1, e[2]), t = t.replace(TodoTxt._complete_replace_re, ""));
        var i = TodoTxt._priority_re.exec(t);
        null !== i && (this.priority = i[1], t = t.replace(TodoTxt._priority_replace_re, ""));
        var o = TodoTxt._date_re.exec(t);
        null !== o && (e = o[1].split("-"), this.date = new Date(e[0], e[1] - 1, e[2]), t = t.replace(TodoTxt._date_replace_re, ""));
        var r = t.match(TodoTxt._context_re);
        if (null !== r) {
            var s;
            for (this.contexts = [], s = 0; s < r.length; s++) this.contexts.push(r[s].trim().substr(1));
            t = t.replace(TodoTxt._context_replace_re, " ")
        }
        var l, u = t.match(TodoTxt._project_re);
        if (null !== u) {
            for (this.projects = [], s = 0; s < u.length; s++) this.projects.push(u[s].trim().substr(1));
            t = t.replace(TodoTxt._project_replace_re, " ")
        }
        if (null !== this.extensions)
            for (s = 0, l = this.extensions.length; s < l; s++)
                if (this.extensions[s] instanceof TodoTxtExtension) {
                    var h = this.extensions[s].parsingFunction(t),
                        c = h[0],
                        a = h[1],
                        p = h[2];
                    null !== a && (t = a), null !== c && (this[this.extensions[s].name] = c), null !== p && (this[this.extensions[s].name + "String"] = p)
                } t = t.replace(TodoTxt._trim_re, ""), this.text = t
    }, this._getNumOfNulls = function (t, e) {
        return null == t && null == e ? 2 : null == t || null == e ? 1 : 0
    }, this._arraysAreEqual = function (t, e) {
        if (2 == this._getNumOfNulls(t, e)) return !0;
        if (1 == this._getNumOfNulls(t, e)) return !1;
        if (t.length != e.length) return !1;
        for (n in t) {
            var n;
            if (-1 == e.indexOf(t[n])) return !1
        }
        return !0
    }, this._datesAreEqual = function (t, e) {
        return 2 == this._getNumOfNulls(t, e) || 1 != this._getNumOfNulls(t, e) && t.setHours(0, 0, 0, 0) - e.setHours(0, 0, 0, 0) == 0
    }, this.equals = function (t) {
        var e, n = ["date", "completed"];
        for (e in n)
            if (!this._datesAreEqual(this[n[e]], t[n[e]])) return !1;
        var i = ["complete", "priority", "text"];
        for (e in i)
            if (this[i[e]] != t[i[e]]) return !1;
        var o = ["projects", "contexts"];
        for (e in o)
            if (!this._arraysAreEqual(this[o[e]], t[o[e]])) return !1;
        return !0
    }, "object" == typeof e && 0 < e.length ? this.extensions = e : this.extensions = null, "string" == typeof t ? this.parse(t) : this.reset()
}

function TodoTxtExtension(t) {
    this.reset = function () {
        this.name = null, this.parsingFunction = null
    }, this.parsingFunction = function (t) {
        return [null, null, null]
    }
}

function HiddenExtension() {
    this.name = "h"
}

function DueExtension() {
    this.name = "due"
} ! function (t) {
    t.TodoTxt = TodoTxt, t.TodoTxtItem = TodoTxtItem
}("undefined" == typeof exports ? window : exports), HiddenExtension.prototype = new TodoTxtExtension, HiddenExtension.prototype.parsingFunction = function (t) {
    var e = null,
        n = /\bh:1\b/;
    return null !== n.exec(t) && (e = !0), [e, t.replace(n, ""), e ? "1" : null]
}, DueExtension.prototype = new TodoTxtExtension, DueExtension.prototype.parsingFunction = function (t) {
    var e = /due:([0-9]{4}-[0-9]{1,2}-[0-9]{1,2})\s*/,
        n = e.exec(t);
    if (null === n) return [null, null, null];
    var i = n[1].split("-");
    return [new Date(i[0], i[1] - 1, i[2]), t.replace(e, ""), n[1]]
},
    function (t) {
        t.TodoTxtExtension = TodoTxtExtension, t.HiddenExtension = HiddenExtension, t.DueExtension = DueExtension
    }("undefined" == typeof exports ? window : exports);